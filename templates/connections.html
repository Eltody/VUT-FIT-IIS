<!doctype html>
<html lang="sk">
    <head>
        <title>CP by (j)Elita</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" type="text/css" href="/static/style.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"> </script>
        <script src="https://kit.fontawesome.com/6079958bc1.js" crossorigin="anonymous"></script>
    </head>
    <body class="background" style="background-image: url('../../static/background.jpg');">
	    <div id="page">
            <nav class="navbar">
                <div class="container">
                    <div id="logo">
                        <a href='/'>CP <em>by (j)Elita</em></a>
                    </div>
                    <div id="menu">
                        <ul>
                            <a href='/preSignIn' id="login">Prihlásiť sa</a>
                            <div class="dropdown">
                                <a href="#" class="hidden" id="user"></a>
                                <div class="dropdown-content">
                                    <a href="#">Lístky</a>
                                    <a href="#">Profil</a>
                                    <a onclick="signOut()" href="/">Odhlásiť sa</a>
                                </div>
                            </div>
                        </ul>
                    </div>
                </div>
            </nav>
            <header id="header"role="banner">
                <div id="loader" class="loader animate__animated animate__fadeIn"><div></div></div>
                <div class="container">
                    <div class="resultFlex">
                        <div class="animate__animated animate__fadeIn animate__faster">
                            <div class="resultWrap">
                                <div class="resultContent" id="content">
                                    <h3 id="notFound" class="hidden" style="color: red; margin: 0;">Žiadny spoj nebol nájdený</h3>
                                    <h3 id="Found">Nájdené spoje:</h3>
                                    <div id="results" style="display: contents;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <footer id="footer">
                <p>Copyright © reserved, Website by <a href="mailto:martin.rakus1@gmail.com?Subject=Email%20z%20webstránky%20CP" target="_top"><i><u>Slovenská (j)Elita.</u></i></a></p>
            </footer>
        </div>
        <!-- Scripts -->
        <script>
            $(function() {
                $("#loadMore").click(function (event) {
                    document.getElementById("loader").classList.remove("hidden");
                    data = oldData;
                    var length = data.length;
                    $.getJSON('/loadMore/[' + data[length - 1] + ']')
                    .done(function(data) {
                        oldData = data;
                        result(data);
                    });
                });
            });

            function result(data) {
                var results = document.getElementById("results");
                for (i in data) {
                    var divMain = document.createElement("div");
                    divMain.classList.add("resultCon");
                    divMain.setAttribute("id", data[i][2] + data[i][7]);
                        var div1 = document.createElement("div");
                            div1.classList.add("resultConHead");
                            var a1 = document.createElement("a");
                            a1.innerHTML = data[i][2];
                                var span1 = document.createElement("span");
                                    span1.innerHTML = data[i][7];
                                a1.appendChild(span1);
                            div1.appendChild(a1);
                            var p1 = document.createElement("p");
                            p1.innerHTML = "Celkový čas ";
                                var strong1 = document.createElement("strong");
                                    strong1.innerHTML = data[i][8];
                                p1.appendChild(strong1);
                            div1.appendChild(p1);
                        divMain.appendChild(div1);
                        var div2 = document.createElement("div");
                        div2.classList.add("resultConDetails");
                            var divBus = document.createElement("div");
                                var p2 = document.createElement("p");
                                    var i1 = document.createElement("i");
                                        i1.classList.add("fas");
                                        i1.classList.add("fa-bus");
                                p2.appendChild(i1);
                            divBus.appendChild(p2);
                                var arrowUp = document.createElement("p");
                                    var i2 = document.createElement("i");
                                        i2.classList.add("fas");
                                        i2.classList.add("fa-arrow-up");
                                arrowUp.appendChild(i2);
                            divBus.appendChild(arrowUp);
                                if (data[0][10].length != 0) {
                                    var middle1 = document.createElement("p");
                                        middle1.setAttribute("name", "more" + data[i][2] + data[i][7]);
                                        middle1.innerHTML = "&zwnj;";
                                    divBus.appendChild(middle1);
                                };
                                var arrowDown = document.createElement("p");
                                    var i2 = document.createElement("i");
                                        i2.classList.add("fas");
                                        i2.classList.add("fa-arrow-down");
                                arrowDown.appendChild(i2);
                            divBus.appendChild(arrowDown);
                            div2.appendChild(divBus);
                            var br = document.createElement("br");
                            div2.appendChild(br);
                            var divInfo1 = document.createElement("div");
                                var divInfo2 = document.createElement("div");
                                divInfo2.classList.add("connectionInfo");
                                    var p3 = document.createElement("p");
                                        p3.innerHTML = data[i][0];
                                divInfo2.appendChild(p3);
                                    var p4 = document.createElement("p");
                                        var strong2 = document.createElement("strong");
                                            strong2.innerHTML = data[i][5];
                                    p4.appendChild(strong2);
                                divInfo2.appendChild(p4);
                            divInfo1.appendChild(divInfo2);
                                var pre1 = document.createElement("pre");
                                    pre1.innerHTML = data[i][2];
                            divInfo1.appendChild(pre1);
                                if (data[0][10].length != 0) {
                                    var middle2 = document.createElement("div");
                                    middle2.setAttribute("onclick", "showMore(this); return false;");
                                    middle2.setAttribute("id", "more" + data[i][2] + data[i][7]);
                                    middle2.style.cursor = "pointer";
                                    middle2.style.zIndex = "1001";
                                    middle2.style.color = "gray";
                                    middle2.classList.add("connectionInfo");
                                    middle2.setAttribute("name", "more" + data[i][2] + data[i][7]);
                                        var middleArrow = document.createElement("i");
                                            middleArrow.setAttribute("onclick", "showMore(this); return false;");
                                            middleArrow.style.cursor = "pointer";
                                            middleArrow.classList.add("fas");
                                            middleArrow.classList.add("fa-chevron-down");
                                    middle2.appendChild(middleArrow);
                                        var middleText = document.createElement("p");
                                            middleText.style.textDecoration = "underline";
                                            middleText.innerHTML = "Zobraziť&nbsp;viac";
                                    middle2.appendChild(middleText);
                                    divInfo1.appendChild(middle2);
                                };
                                var pre2 = document.createElement("pre");
                                    pre2.innerHTML = data[i][4];
                            divInfo1.appendChild(pre2);
                            div2.appendChild(divInfo1);
                            div2.appendChild(br);
                            var divInfo3 = document.createElement("div");
                                var p5 = document.createElement("p");
                                    p5.innerHTML = "&zwnj;";
                                divInfo3.appendChild(p5);
                                var p6 = document.createElement("p");
                                    p6.innerHTML = data[i][1];
                                divInfo3.appendChild(p6);
                                    if (data[0][10].length != 0) {
                                        var middle3 = document.createElement("p");
                                            middle3.setAttribute("name", "more" + data[i][2] + data[i][7]);
                                            middle3.innerHTML = "&zwnj;";
                                        divInfo3.appendChild(middle3);
                                    };
                                    var p7 = document.createElement("p");
                                        p7.innerHTML = data[i][3];
                                divInfo3.appendChild(p7);
                            div2.appendChild(divInfo3);
                        divMain.appendChild(div2);
                        var div3 = document.createElement("div");
                        div3.classList.add("resultConFooter");
                        div3.setAttribute("id", "div2" + data[i][2] + data[i][7]);
                            var p8 = document.createElement("p");
                                var i3 = document.createElement("i");
                                    i3.classList.add("fas");
                                    i3.classList.add("fa-user");
                                p8.appendChild(i3);
                                var strong3 = document.createElement("strong");
                                    strong3.innerHTML = "&ensp;" + data[i][6] + "&ensp;";
                                p8.appendChild(strong3);
                                var p9 = document.createElement("p");
                                    p9.innerHTML = "voľných miest";
                                p8.appendChild(p9);
                            div3.append(p8);
                            var divFooter = document.createElement("div");
                                divFooter.style.display = "inherit";
                                divFooter.style.alignItems = "center";
                                divFooter.setAttribute("id", "div1" + data[i][2] + data[i][7]);
                                var p10 = document.createElement("p");
                                    p10.innerHTML = "Cena ";
                                    var strong4 = document.createElement("strong");
                                        strong4.innerHTML = data[i][9];
                                    p10.appendChild(strong4);
                                    p10.innerHTML = " ";
                                divFooter.appendChild(p10);
                                    var a2 = document.createElement("a");
                                    a2.setAttribute("onclick", "buy(this); return false;");
                                    a2.setAttribute("href", "#");
                                    a2.setAttribute("id", "button" + data[i][2] + data[i][7]);
                                    var i4 = document.createElement("i");
                                        i4.classList.add("fas");
                                        i4.classList.add("fa-credit-card");
                                    a2.appendChild(i4);
                                    var p12 = document.createElement("p");
                                        p12.innerHTML = " Kúpiť";
                                        p12.style.paddingLeft = "5px";
                                    a2.appendChild(p12);
                                divFooter.appendChild(a2);
                        div3.appendChild(divFooter);
                    divMain.appendChild(div3);
                    results.appendChild(divMain);
                };
                document.getElementById("loader").classList.remove("animate__fadeIn");
                document.getElementById("loader").classList.add("animate__fadeOut");
                setTimeout(function() {
                    document.getElementById("loader").classList.add("hidden");
                    document.getElementById("loader").classList.add("animate__fadeIn");
                    document.getElementById("loader").classList.remove("animate__fadeOut");
                }, 500);
            };
        </script>
        <script>
            function showMore(elem) {
                var list = document.getElementsByName(elem.id);
                for (x in list) {
                    list[x].innerHTML = "";
                }
                for (x in data[0][10]) {
                    var stops = elem.parentNode.parentNode;
                    var element = stops.childNodes[0];
                    var times = element.childNodes[1];
                    var p1 = document.createElement("p");
                        p1.setAttribute("name", "more");
                        p1.innerHTML = "&zwnj;";
                    element.insertBefore(p1, times.nextSibling);

                    element = stops.childNodes[1];
                    times = element.childNodes[1];
                    var p2 = document.createElement("p");
                        p2.setAttribute("name", "more");
                        var i = document.createElement("i");
                            i.classList.add("fas");
                            i.classList.add("fa-ellipsis-v");
                        p2.appendChild(i);
                    element.insertBefore(p2, times.nextSibling);

                    element = stops.childNodes[3];
                    times = element.childNodes[1];
                    var p = document.createElement("p");
                        p.setAttribute("name", "more");
                        p.innerHTML = data[0][10][x];
                    element.insertBefore(p, times.nextSibling);
                };
            };
        </script>
        <script>
            var cookies = document.cookie.split('; ');
            var c = [];
            for (var i = 0; i < cookies.length; i++) {
                c.push(cookies[i].split('='));
            }
            if (c[0][0] === "name") {
                document.getElementById("user").classList.remove("hidden");
                document.getElementById("login").classList.add("hidden");
                document.getElementById("user").innerHTML = c[0][1];
            }
            function signOut() {
                document.cookie = "name=; Max-Age=0";
                document.cookie = "email=; Max-Age=0";
                location.reload();
            }
        </script>
        <script>
            var message = "{{data.message}}";
            var name = "{{data.name}}";
            if (message !== '') {
                document.getElementById("user").classList.remove("hidden");
                document.getElementById("login").classList.add("hidden");
                document.getElementById("user").innerHTML = name;
            }
        </script>
        <script>
            let buy2 = null;
            let data = {{data|tojson}};
            let oldData = data;
            if (data.length === 0) {
                document.getElementById("notFound").classList.remove("hidden");
                document.getElementById("Found").classList.add("hidden");
            } else {
                var input = document.createElement("input");
                    input.setAttribute("type", "button");
                    input.setAttribute("id", "loadMore");
                    input.classList.add("buttonSearch");
                    input.setAttribute("value", "Načítať ďalšie spoje");
                results = document.getElementById(results.parentNode.id);
                results.appendChild(input);
                result(data);
            };
        </script>
        <script>
            function buy(elem){
                var cookies = document.cookie.split('; ');
                var c = [];
                for (var i = 0; i < cookies.length; i++) {
                    c.push(cookies[i].split('='));
                }
                if (c[0][0] === "name") {
                    if (typeof document.getElementById("divBuy" + buy2) === 'undefined' || document.getElementById("divBuy" + buy2) === null) {
                        var buy = document.getElementById(elem.parentNode.id);
                        buy2 = document.getElementById(buy.parentNode.id);
                        buy = document.getElementById(buy2.parentNode.id);
                        buy2 = buy2.parentNode.id;
                        var divBuy = document.createElement("div");
                            divBuy.classList.add("resultConDetails");
                            divBuy.setAttribute("id", "divBuy" + buy2);
                            var a11 = document.createElement("a");
                            a11.innerHTML = data[i][2];
                                var span11 = document.createElement("span");
                                    span11.innerHTML = data[i][7];
                                a11.appendChild(span11);
                            divBuy.appendChild(a11);
                            var p11 = document.createElement("p");
                            p11.innerHTML = "Celkový čas ";
                                var strong11 = document.createElement("strong");
                                    strong11.innerHTML = data[i][8];
                                p11.appendChild(strong11);
                            divBuy.appendChild(p11);
                        buy.appendChild(divBuy);
                    } else {
                        var tmp = document.getElementById(elem.parentNode.id);
                        tmp = document.getElementById(tmp.parentNode.id);
                        tmp = tmp.parentNode.id;
                        var isSet = false;
                        if (buy2 != tmp) {
                            isSet = true;
                        };
                        var remove = document.getElementById("divBuy" + buy2);
                        remove.remove();
                        buy2 = null;
                        if (isSet == true) {
                            var buy = document.getElementById(elem.parentNode.id);
                            buy2 = document.getElementById(buy.parentNode.id);
                            buy = document.getElementById(buy2.parentNode.id);
                            buy2 = buy2.parentNode.id;
                            var divBuy = document.createElement("div");
                                divBuy.classList.add("resultConHead");
                                divBuy.setAttribute("id", "divBuy" + buy2);
                                var a11 = document.createElement("a");
                                a11.innerHTML = data[i][2];
                                    var span11 = document.createElement("span");
                                        span11.innerHTML = data[i][7];
                                    a11.appendChild(span11);
                                divBuy.appendChild(a11);
                                var p11 = document.createElement("p");
                                p11.innerHTML = "Celkový čas ";
                                    var strong11 = document.createElement("strong");
                                        strong11.innerHTML = data[i][8];
                                    p11.appendChild(strong11);
                                divBuy.appendChild(p11);
                            buy.appendChild(divBuy);
                        };
                    };
                } else {
                    location.href = "/preSignIn";
                }
            }
        </script>
    </body>
</html>